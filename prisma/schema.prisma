generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

enum SubscriptionStatus {
  PENDING
  ACTIVE
  CANCELED
  EXPIRED
}

model User {
  id            String    @id @default(cuid())
  name          String?
  email         String    @unique
  emailVerified DateTime?
  image         String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  password      String?

  // Subscription fields
  subscriptionStatus    SubscriptionStatus @default(PENDING)
  caktoCustomerId       String?
  caktoSubscriptionId   String?
  subscriptionStartDate DateTime?
  subscriptionEndDate   DateTime?

  accounts              Account[]
  Authenticator         Authenticator[]
  ProductRecommendation ProductRecommendation[]
  sessions              Session[]
  skinProfile           SkinProfile?
}

model Account {
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  user              User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@id([provider, providerAccountId])
}

model Session {
  sessionToken String   @unique
  userId       String
  expires      DateTime
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model VerificationToken {
  identifier String
  token      String
  expires    DateTime

  @@id([identifier, token])
}

model Authenticator {
  credentialID         String  @unique
  userId               String
  providerAccountId    String
  credentialPublicKey  String
  counter              Int
  credentialDeviceType String
  credentialBackedUp   Boolean
  transports           String?
  user                 User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@id([userId, credentialID])
}

model SkinProfile {
  id                      String   @id @default(cuid())
  userId                  String?  @unique
  createdAt               DateTime @default(now())
  updatedAt               DateTime @updatedAt
  allergyDetails          String?
  brandPreference         String?
  cleansingFrequency      String?
  climate                 String?
  cosmeticsBurn           Boolean?
  currentMedication       String?
  currentTreatment        String?
  diet                    String?
  dilatedPoresLocation    String?
  feelsTightAfterWashing  Boolean?
  getsRedEasily           Boolean?
  getsShinySkin           Boolean?
  hasAcne                 Boolean?
  hasAllergies            Boolean?
  hasAtopicDermatitis     Boolean?
  hasDilatedPores         Boolean?
  hasFlakingSkin          Boolean?
  hasMelasma              Boolean?
  hasPsoriasis            Boolean?
  hasRosacea              Boolean?
  hasSeborrheicDermatitis Boolean?
  hormonalTreatment       Boolean?
  hormonalTreatmentType   String?
  intensiveWorkout        Boolean?
  irritatingIngredients   String[]
  mainGoal                String?
  morningProducts         String[]
  nightProducts           String[]
  oilProductionArea       String?
  preferredTexture        String[]
  prefersFragrance        String?
  procedureDate           String?
  procedureType           String?
  recentProcedures        Boolean?
  retinolReaction         String?
  routineSteps            Int?
  secondaryGoals          String[]
  skinIrritationFrequency String?
  sleepsWithAC            Boolean?
  triedRetinol            Boolean?
  usesAntibiotics         Boolean?
  usesCorticoids          Boolean?
  usesMakeup              String?
  usesSunscreenDaily      Boolean?
  sunExposure             String?
  user                    User?    @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model ProductRecommendation {
  id          String        @id @default(cuid())
  productId   String
  name        String
  category    String
  description String
  searchTerms String[]
  userId      String
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  User        User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  PurchaseUrl PurchaseUrl[]

  @@index([userId])
}

model PurchaseUrl {
  id                    String                @id @default(cuid())
  storeName             String
  url                   String
  recommendationId      String
  createdAt             DateTime              @default(now())
  ProductRecommendation ProductRecommendation @relation(fields: [recommendationId], references: [id], onDelete: Cascade)
}
